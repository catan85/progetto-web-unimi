
<!DOCTYPE HTML>
<!--
	Astral by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Astral by HTML5 UP</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="stylesheets/main.css" />
		<noscript><link rel="stylesheet" href="stylesheets/noscript.css" /></noscript>

	</head>
	<body class="is-preload">

		<!-- Wrapper-->
			<div id="wrapper">

				<!-- Nav -->
					<nav id="nav">
						<a href="#home" class="icon fa-home"><span>Home</span></a>
            			<a href="#charts" class="icon fa-line-chart"><span>Charts</span></a>
					</nav>

				<!-- Main -->
					<div id="main">
					<article id="home" class="panel intro">
					   <header>
							{{#if user}}
								<p>Hello, {{user.username}}!</p>
							{{else}}
								<p>Welcome! Please <a href="#login">log in</a>.</p>
							{{/if}}
					   </header>
					</article>
					
					<article id="charts" class="panel">
						{{#if user}}
					
							<p>Charts page:</p>
							
							<canvas id="line-chart" ></canvas>

							<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
							<script>
								function createXMLHttpRequest() {
									try {return new ActiveXObject("Msxml2.XMLHTTP");} catch (e) {}
									try {return new ActiveXObject("Microsoft.XMLHTTP");} catch (e) {}
									try {return new XMLHttpRequest(); } catch (e) {}
									alert("XMLHttpRequest non supportato");
									return null;
								}
								window.onload = function() {
									var rq = createXMLHttpRequest();
									rq.onreadystatechange = function(){
										if (rq.readyState==4){
											if(rq.status==200){ 
												response = JSON.parse(rq.response);
												console.dir(response);

												// response Ã¨ un array di 30 valori che
												// deve poi essere passaro al chart
												new Chart(document.getElementById("line-chart"), {
												type: 'line',
												data: {
													labels: response.map(v => v.timestamp),
													datasets: [{ 
														data: response.map(v => v.torque),
														label: "Torque",
														borderColor: "#3e95cd",
														fill: false,
														yAxisID: 'ax1',
													}, { 
														data: response.map(v => v.speed),
														label: "Speed",
														borderColor: "#8e5ea2",
														fill: false,
														yAxisID: 'ax2',
													}, { 
														data: response.map(v => v.temperature),
														label: "Temperature",
														borderColor: "#3cba9f",
														fill: false,
														yAxisID: 'ax3',
													}
													]
												},
												options: {
													title: {
														display: true,
														text: 'Measures'
													},
													scales: {
														yAxes: 
														[	{
																id: 'ax1',
																type: 'linear',
																position: 'left',
															}, {
																id: 'ax2',
																type: 'linear',
																position: 'right'
															}, {
																id: 'ax3',
																type: 'linear',
																position: 'right'//,
																//ticks: {
																//	max: 1,
																//	min: 0
																//}
															}
														]
													}
												}
												});

											}
											else{alert("Errore di chiamata");}
										}			
									}
									rq.open("GET", "api/charts", true); // apre la connessione 
									rq.send();
								}
								

								
							</script>
						{{else}}
							<p> Please <a href="#login">log in</a>.</p>
						{{/if}}

					</article>

					  <article id="login" class="panel">
						    <form action="/login" method="post">
								<div>
								<label>Username:</label>
								<input type="text" name="username"/><br/>
								</div>
								<div>
								<label>Password:</label>
								<input type="password" name="password"/>
								</div>
								<div>
								<input type="submit" value="Submit"/>
								</div>
							</form>
					  </article>
			  		</div>

				<!-- Footer -->
					<div id="footer">
						<ul class="copyright">
							<li>&copy; Untitled.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>

			</div>



		<!-- Scripts -->
			<script src="javascripts/jquery.min.js"></script>
			<script src="javascripts/browser.min.js"></script>
			<script src="javascripts/breakpoints.min.js"></script>
			<script src="javascripts/util.js"></script>
			<script src="javascripts/main.js"></script>
			
			
	</body>
</html>